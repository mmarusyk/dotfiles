name: vscode_ubuntu
description: Install and configure Visual Studio Code on Ubuntu

steps:
  - name: check_vscode
    script: |
      if command -v code &> /dev/null; then
        echo "‚úÖ Visual Studio Code is already installed."
        exit 0
      fi

  - name: install_vscode
    script: |
      log_verbose "üì¶ Installing..."
      echo "code code/add-microsoft-repo boolean true" | sudo debconf-set-selections
      
      sudo apt-get install -y wget gpg
      wget -qO- https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor > packages.microsoft.gpg
      sudo install -D -o root -g root -m 644 packages.microsoft.gpg /etc/apt/keyrings/packages.microsoft.gpg
      echo "deb [arch=amd64,arm64,armhf signed-by=/etc/apt/keyrings/packages.microsoft.gpg] https://packages.microsoft.com/repos/code stable main" | sudo tee /etc/apt/sources.list.d/vscode.list > /dev/null
      rm -f packages.microsoft.gpg
      
      sudo apt install -y apt-transport-https
      sudo apt update
      sudo apt install -y code
      echo "‚úÖ Visual Studio Code installed!"

  - name: install_extensions
    script: |
      echo "üîå Installing VS Code extensions..."
      code --install-extension aaron-bond.better-comments
      code --install-extension aliariff.vscode-erb-beautify
      code --install-extension amazonwebservices.aws-toolkit-vscode
      code --install-extension ms-vscode-remote.remote-containers
      code --install-extension shopify.ruby-extensions-pack
      code --install-extension vscodevim.vim
      code --install-extension vscode-icons-team.vscode-icons
      code --install-extension github.copilot-chat
      echo "‚úÖ Extensions installed!"

  - name: copy_settings
    script: |
      log_verbose "üìù Copying..."
      ROOT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/../../.." && pwd)"
      HOME_DIR="$HOME/.config/Code/User"
      mkdir -p "$HOME_DIR"
      cp -f "$ROOT_DIR/config/vscode/settings.json" "$HOME_DIR/settings.json"
      echo "‚úÖ VS Code configured!"
